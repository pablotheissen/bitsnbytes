{% include "partials/head.html" %}
<form action="" method="POST">
    <div class="wrapper-input wrapper-title{% if error_title is not empty %} error{% endif %}">
        <label for="inpt-title">Title</label>{% if error_message_title is not empty %}
        <span class="error-message error-message-title">{{ error_message_title | raw }}</span>{% endif %}
        <input id="inpt-title" type="text" name="title" value="{{ title }}" placeholder="Title" required>
    </div>
    <div class="wrapper-input wrapper-slug{% if error_slug is not empty %} error{% endif %}">
        <label for="inpt-slug">Slug</label>{% if  error_message_slug is not empty %}
        <span class="error-message error-message-slug">{{ error_message_slug | raw }}</span>{% endif %}
        <input id="inpt-slug" type="text" name="slug" value="{{ slug }}" placeholder="slug" pattern="[a-z0-9-_]*">
    </div>
    <div class="wrapper-input wrapper-url{% if error_url is not empty %} error{% endif %}">
        <label for="inpt-url">URL</label>
        <input id="inpt-url" type="url" name="url" value="{{ url }}" placeholder="https://example.org">
    </div>
    <div class="wrapper-input wrapper-text{% if error_text is not empty %} error{% endif %}">
        <label for="inpt-text">Content</label>
        <textarea id="inpt-text" name="text" rows="5" placeholder="">{{ text }}</textarea>
    </div>
    <div class="wrapper-input wrapper-datetime{% if error_datetime is not empty %} error{% endif %}">
        <div class="wrapper-input-inner wrapper-date{% if error_date is not empty %} error{% endif %}">
            <label for="inpt-date">Date</label>
            <input id="inpt-date" type="date" name="date" value="{{ date_atom_date }}">
        </div>
        <div class="wrapper-input-inner wrapper-time{% if error_time is not empty %} error{% endif %}">
            <label for="inpt-time">Time</label>
            <input id="inpt-time" type="time" name="time" value="{{ date_atom_time }}">
        </div>
    </div>
    <div class="wrapper-input wrapper-tags">
        <label>Tags</label>
        <ul>
            {% for tag in tags %}
            <li><input name="tags[]" type="text" class="inpt-tag" value="{{ tag.title }}"></li>
            {% endfor %}
            <li><input name="tags[]" type="text" class="inpt-tag" value=""></li>
            {% if tags is empty %}
            <li><input name="tags[]" type="text" class="inpt-tag" value=""></li>
            {% endif %}
        </ul>
    </div>
    <button type="submit">Save</button>
</form>

<script>
    document.querySelector('#inpt-url').addEventListener('blur', function(e) {
        window.fetch('/fetch?url='+encodeURIComponent(this.value), {method: 'get'/*, signal: signal*/}).then(response => {
            fetchActive = false;
            if (response.ok)
                return response.json();
            else
                throw new Error('Could load results.'); // TODO handle errors correctly
        }).then(function (json) {
            if(document.querySelector('#inpt-title').value === '') {
                document.querySelector('#inpt-title').value = json['title'];
            }
            if(document.querySelector('#inpt-text').innerText === '') {
                document.querySelector('#inpt-text').innerText = json['description'];
            }
        }).catch(function (err) {
            // catch errors, e.g. when fetch was aborted
        });
    });
</script>

{% include "partials/foot.html" %}